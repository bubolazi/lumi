# Email Templates for Lumi Learning

This directory contains email templates used for user registration and authentication in the LUMI application.

## Templates

### Confirmation Email (`confirmation.html` and `confirmation.txt`)

**Purpose**: Sent when a new user creates an account to verify their email address.

**Theme**: Matches the app's green monochrome terminal aesthetic with:
- Terminal green color (#00ff41) on black background
- Courier Prime monospace font
- Terminal-style prompts and borders
- Clean, kid-friendly messaging in Bulgarian

**Variables** (Supabase template syntax):
- `{{ .User.UserMetadata.name }}` - User's display name
- `{{ .ConfirmationURL }}` - Auto-generated confirmation link with redirect

## Supabase Configuration

These templates are designed to work with Supabase Auth. To configure them:

### Step 1: Access Email Templates

1. Open your Supabase project dashboard
2. Navigate to **Authentication** → **Email Templates**
3. Select **Confirm signup** template

### Step 2: Configure HTML Template

1. Copy the contents of `confirmation.html`
2. Paste into the **HTML Template** field
3. The template uses Supabase's built-in variables:
   - `{{ .User.UserMetadata.name }}` - Populated from user metadata during signup
   - `{{ .ConfirmationURL }}` - Auto-generated by Supabase with redirect URL

### Step 3: Configure Plain Text Template

1. Copy the contents of `confirmation.txt`
2. Paste into the **Plain Text Template** field
3. Uses the same variables as HTML version

### Step 4: Configure Redirect URL

In **Authentication** → **URL Configuration**:
- Set **Site URL** to your production URL (e.g., `https://lumi.example.com`)
- Set **Redirect URLs** to include your app URLs (e.g., `https://lumi.example.com/**`)

### Step 5: Test the Email

1. Create a test account in your app
2. Check the email sent to the test address
3. Verify:
   - Email displays correctly in your email client
   - Green terminal theme is visible
   - Confirmation button/link works
   - Redirect takes you back to the app

## Template Variables

Supabase provides the following variables for email templates:

| Variable | Description | Example |
|----------|-------------|---------|
| `{{ .ConfirmationURL }}` | Email confirmation link | `https://xxx.supabase.co/auth/v1/verify?token=...` |
| `{{ .Token }}` | Confirmation token only | `abc123...` |
| `{{ .TokenHash }}` | Hashed token | `def456...` |
| `{{ .SiteURL }}` | Your configured site URL | `https://lumi.example.com` |
| `{{ .User.Email }}` | User's email address | `user@example.com` |
| `{{ .User.UserMetadata.name }}` | User's name from metadata | `Иван` |

## Setting User Metadata

To populate `{{ .User.UserMetadata.name }}`, ensure your signup flow includes:

```javascript
const { data, error } = await supabase.auth.signUp({
  email: userEmail,
  password: userPassword,
  options: {
    data: {
      name: userName  // This populates {{ .User.UserMetadata.name }}
    }
  }
})
```

## Email Client Compatibility

The HTML template is designed to work across major email clients:

- ✅ Gmail (web, mobile)
- ✅ Outlook (web, desktop)
- ✅ Apple Mail (macOS, iOS)
- ✅ Yahoo Mail
- ✅ ProtonMail
- ✅ Thunderbird

**Fallback**: Plain text version provided for clients that don't support HTML emails.

## Testing Email Templates

### Preview in Email Client

1. Send yourself a test email through Supabase
2. Check how it renders in your email client
3. Test the confirmation link

### Test Variables

When testing, Supabase will automatically populate:
- Real confirmation URL
- Real user email
- User metadata (if provided during signup)

### Preview Tools

You can also preview the HTML template using:
- [Litmus](https://www.litmus.com/) - Email testing platform
- [Email on Acid](https://www.emailonacid.com/) - Email preview tool
- [Mailtrap](https://mailtrap.io/) - Email testing sandbox

## Customization

To customize the templates for your needs:

### Colors

The terminal green theme uses:
- Primary: `#00ff41` (terminal green)
- Background: `#000000` (black)
- Dim green: `#009900` (darker green for borders)
- Hover: `#003300` (dark green background)

### Fonts

- Primary: `'Courier Prime', 'Courier New', monospace`
- Fallback: System monospace fonts

### Text Content

All text is in Bulgarian (bg). To translate:
1. Update text in both `confirmation.html` and `confirmation.txt`
2. Update `lang="bg"` attribute in HTML template if changing language
3. Keep the terminal aesthetic and friendly tone

## Troubleshooting

### Email not received

1. Check spam/junk folder
2. Verify email address is correct
3. Check Supabase logs in **Authentication** → **Logs**

### Confirmation link doesn't work

1. Verify **Redirect URLs** are configured in Supabase
2. Check link hasn't expired (24 hour validity)
3. Ensure **Site URL** matches your production URL

### Template variables not showing

1. Verify variable syntax: `{{ .VariableName }}`
2. Check user metadata was provided during signup
3. Review Supabase template documentation

## Additional Email Templates

You can create additional templates for:
- **Password Reset**: `reset-password.html` / `reset-password.txt`
- **Magic Link**: `magic-link.html` / `magic-link.txt`
- **Email Change**: `email-change.html` / `email-change.txt`

Each template should follow the same terminal green theme for consistency.

## Support

For issues with email templates:
1. Check [Supabase Email Templates Documentation](https://supabase.com/docs/guides/auth/auth-email-templates)
2. Review Supabase Auth logs
3. Test with different email providers

## License

These email templates are part of the Lumi Learning application and follow the same license as the main project.
